<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cellular Automata</title>
    <style>
        .row {
            font-size: 0;
            width: 800px;
        }
        
        .cell {
            display: inline-block;
            height: 2px;
            /*margin: 0 1px 1px 0;*/
            width: 2px;
        }
        
        .active {
            background: #0099ff;
        }
        
        .inactive {
            background: #ccc;
        }
    </style>
</head>

<body>
    <script>
        const randomInt = (max = 10, min = 0) => {
            return Math.floor(
                Math.random() * (max - min + 1) + min
            )
        }

        const render = () => {
            let row = document.createElement('div')
            row.classList.add('row')

            const currentRow = state[state.length - 1]
            for (let i = 0; i < currentRow.length; i++) {
                const cell = document.createElement('div')
                cell.classList.add('cell', currentRow[i] ? 'active' : 'inactive')
                row.appendChild(cell)
            }

            document.body.appendChild(row)
        }

        const nextGenValue = (siblingLeft = 0, prevValue, siblingRight = 0) => {
            const tests = [
                [[1,1,1], 1],
                [[1,1,0], 1],
                [[1,0,1], 1],
                [[1,0,0], 0],
                [[0,1,1], 0],
                [[0,1,0], 0],
                [[0,0,1], 0],
                [[0,0,0], 1]
            ]
            const current = [siblingLeft, prevValue, siblingRight]

            let newValue

            tests.forEach((value) => {
                if (value[0][0] === siblingLeft &&
                    value[0][1] === prevValue &&
                    value[0][2] === siblingRight) {
                        newValue = value[1]
                    }
            })

            return newValue
        } 

        const createRow = (currentState = []) => {
            if (currentState[0] == null) { 
                // create random seed
                let row = []
                for (let i = 0; i < 400; i++) {
                    row.push(randomInt(1))
                }
                return row
            }
            const lastRowIndex = currentState.length - 1
            return currentState[lastRowIndex].map((value, index, array) => {
                const sibling1 = array[--index]
                const sibling2 = array[++index]
                return nextGenValue(sibling1, value, sibling2)
            })
        }

        let timer
        const ticker = () => {
            state.push(createRow(state))
            render()
            timer = window.setTimeout(ticker, 3)
        }

        let state = []

        ticker()

        // stop this nonsence
        setTimeout(() => window.clearTimeout(timer), 10000)
    </script>
</body>

</html>